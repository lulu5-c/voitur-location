<?php

namespace App\Http\Controllers;
use Auth;
use App\Models\Voiture;
use App\Models\UserVoiture;
use App\Models\Category;
use Illuminate\Http\Request;

class PageController extends Controller
{
    public function index()
    {
        $voitures = Voiture::all();
        $categories = Category::all();
        return view('home', compact('voitures', 'categories'));
    }

    public function cate(Request $request)
    {
        
        $voitures = Voiture::where('categorie_id', $request->input('categorie_id'))->get();
        $categories = Category::all();

        return view('louer', compact('voitures', 'categories'));
    }


    public function louer()
    {
        $user_voitures = UserVoiture::all();
        $categories = Category::all();
        $voitures = Voiture::orderBy('prix','DESC')->SimplePaginate(10);
        return view('louer', compact('voitures', 'categories'));
    }


    public function modal(Request $request){
        
        $categories = Category::all();
        $voitures =  Voiture::orderBy('prix','DESC')->SimplePaginate(10);
        $model = new UserVoiture;
        $model->voiture_marque = $request->input('marque');
        $model->nombre = $request->input('nombre');
        $model->louer = 'oui';
        $model->restituer =  '';
        $model->dateLocation =  $request->input('dateLocation');
        $model->dateRendu =  $request->input('dateRendu');
        $model->user_id =  $request->input('user_id');
        $model->voiture_id =  $request->input('voiture_id');
        $model->save();
        return view('louer', compact('voitures', 'categories'))->with('message', 'la voiture a ete louer avec success!');
    }

    public function voiture(Request $request){
        $voiture = Voiture::find($request->input('id'));
        return view('/voiture',  compact('voiture') );

    }
    public function valider(Request $request){
        $user_voitures = UserVoiture::all();
        $voiture = Voiture::find($request->input('id'))->first();
        $categories = Category::all();
        return view('/modal',  compact('voiture', 'categories', 'user_voitures') );

    }
    public function restituer(){
        $voitures = Voiture::all();
        $user_voitures = UserVoiture::where('user_id', Auth::user()->id)->get();
        $categories = Category::all();
        return view('/restituer', compact('voitures','user_voitures', 'categories'));
    }
    public function restitution(Request $request){
        UserVoiture::where('id', $request->input('id'))->update([
            'restituer' =>$request->input('restituer') ]);
        return redirect()->back();   
     }

     public function search(Request $request){
        
        $voitures = Voiture::where('description', 'like', "%".$request->input('search')."%");
        $categories = Category::all();

        return view('louer', compact('voitures', 'categories'));
           
     }

     

































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































}
